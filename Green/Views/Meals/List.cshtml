@using Green.Models
@{
    ViewBag.Title = "Meals";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    input[type=search] {
        width: 130px;
        box-sizing: border-box;
        border: 2px solid #ccc;
        border-radius: 4px;
        font-size: 16px;
        background-color: white;
        background-position: 10px 10px;
        background-repeat: no-repeat;
        padding: 12px 20px 12px 40px;
        -webkit-transition: width 0.4s ease-in-out;
        transition: width 0.4s ease-in-out;
    }

        input[type=search]:focus {
            width: 100%;
        }
</style>

<div id="meals">
    <h2>Meals</h2>
    @if (User.IsInRole("AppAdmin"))
    {
        <input type="button" value="New" class="btn btn-primary" data-toggle="modal" data-target="#mealItem" data-bind="click:add" />
    }
    <div class="form-inline">
        <input type="search" id="searchBox" placeholder="Search...">
        <button id="infoButton" class="btn btn-default" data-toggle="tooltip" title="Search" data-bind="click: search">
            <span class="glyphicon glyphicon-search"></span>
        </button>
    </div>

    <div class="container">
        <div class="form-inline">
            <input type="checkbox" id="SearchName" data-bind="checked: SearchName" />
            <label for="SearchName">Search in name</label>
            <input type="checkbox" id="SearchIngredient" data-bind="checked: SearchIngredient" />
            <label for="SearchIngredient">Search in ingredients</label>
        </div>
    </div>

    <div class="container-fluid" style="padding-left:8%; padding-right:8%;">
        <div class="row" data-bind="foreach:Meals">
            <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3" style="box-shadow: 0 5px 18px 0 rgba(0,0,0,0.2); transition: 0.3s; border-radius: 5px; margin-top:0.5%; margin-bottom:0.5%;">
                <h5 data-bind="text:Name"></h5>
                <p data-bind="text:Description"></p>
                @if (User.IsInRole("AppAdmin"))
                {
                    <div class="form-horizontal">
                        <buttod id="detailsButton" class="btn btn-success" data-toggle="modal" data-target="#mealItem" data-bind="click: $root.details" style="width:40%;">Details</buttod>
                        <button id="cancelButton" class="btn btn-danger" data-toggle="tooltip" title="Delete." data-bind="click:$root.delete" style="width:40%;">Delete</button>
                    </div>
                }
            </div>
        </div>
    </div>

    @Html.Partial("MealItem")
</div>
<script>
    $(function () {
        ko.cleanNode($("#meals")[0]);
        var vmMeals = new Meals();
        vmMeals.refresh();
        ko.applyBindings(vmMeals, $("#meals").get(0));

        ko.cleanNode($("#foodItem")[0]);
        var vmFoods = new Foods();
        vmFoods.refresh();
        ko.applyBindings(vmFoods, $("#foodItem").get(0));
    });
</script>
